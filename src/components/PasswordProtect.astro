---
interface Props {
  password: string;
  id?: string;
  title?: string;
  description?: string;
}

const {
  password,
  id = `password-protect-${Math.random().toString(36).substr(2, 9)}`,
  title = '请输入密码',
  description = '',
} = Astro.props;
---

<div id={id} class="password-protect-container" data-password="{password}" data-storage-key="password_unlocked_{id}">
  <div class="password-prompt">
    <h2 class="text-2xl font-semibold mb-4">{title}</h2>
    {description && <p class="mb-4 text-gray-600 dark:text-gray-400">{description}</p>}
    <input 
      type="password" 
      class="w-full max-w-md px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500"
      placeholder="请输入密码"
    />
    <button 
      class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
    >
      确认
    </button>
    <p class="mt-4 text-red-500 hidden">密码错误，请重新输入</p>
  </div>
  
  <div class="protected-content hidden">
    <slot />
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const containers = document.querySelectorAll('.password-protect-container');
    
    containers.forEach(function(container) {
      const passwordPrompt = container.querySelector('.password-prompt');
      const protectedContent = container.querySelector('.protected-content');
      const passwordInput = container.querySelector('input[type="password"]');
      const submitButton = container.querySelector('button');
      const errorMessage = container.querySelector('p.text-red-500');
      
      const correctPassword = container.getAttribute('data-password');
      const storageKey = container.getAttribute('data-storage-key');
      
      // 检查本地存储中是否已解锁
      if (localStorage.getItem(storageKey) === 'true') {
        passwordPrompt.classList.add('hidden');
        protectedContent.classList.remove('hidden');
      }
      
      // 提交密码
      submitButton.addEventListener('click', function() {
        const enteredPassword = passwordInput.value.trim();
        
        if (enteredPassword === correctPassword) {
          // 密码正确
          errorMessage.classList.add('hidden');
          passwordPrompt.classList.add('hidden');
          protectedContent.classList.remove('hidden');
          // 存储解锁状态
          localStorage.setItem(storageKey, 'true');
        } else {
          // 密码错误
          errorMessage.classList.remove('hidden');
        }
      });
      
      // 按 Enter 键提交密码
      passwordInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          submitButton.click();
        }
      });
    });
  });
</script>

<style>
  .password-protect-container {
    background-color: var(--bg-color, #f3f4f6);
    border-radius: 0.5rem;
    padding: 2rem;
    margin: 1rem 0;
  }
  
  .dark .password-protect-container {
    background-color: var(--dark-bg-color, #1f2937);
  }
  
  .password-prompt {
    text-align: center;
  }
  
  .protected-content {
    animation: fadeIn 0.5s ease-in-out;
  }
  
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
